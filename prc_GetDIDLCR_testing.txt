-- C:\tmp\Comparison UIFN v4.xlsx Testing 
sheet 1
call prc_GetDIDLCR_NEW(1, '67', 'Premium Rate Number', '','0.15 per minute' ,'070' ,'9' , 1, '5' ,'2019-11-28','100','300','13','80','FIX','60','2019-10-28','2019-11-28','0' ,1,50,'desc',0)
call prc_GetDIDLCR_NEW(1, '67', 'Premium Rate Number', '','0.15 per minute' ,'070' ,'9' , 1, '5' ,'2019-11-28','100','300','13','80','MOB','40','2019-10-28','2019-11-28','0' ,1,50,'desc',0)
-- €34.18590000<br>Proximus - PRS<br>19/11/2019
-- €34.18590000<br>Proximus - PRS<br>19/11/2019

sheet 2 , 4
call prc_GetDIDLCR_TEST(1, '67', 'Premium Rate Number', '','1 per minute' ,'0902' ,'9' , 1, '5' ,'2019-11-28','100','300','13','80','FIX','60','2019-10-28','2019-11-28','0' ,1,50,'desc',0)
-- €-140.46780000<br>Proximus - PRS<br>19/11/2019  €-183.43380000<br>Colt BE - PRS - FF<br>21/11/2019
    -140.46780000									-183.43380000

sheet 3 ,5 
call prc_GetDIDLCR_TEST(1, '67', 'Premium Rate Number', '','0.5 per call' ,'0905' ,'9' , 1, '5' ,'2019-11-28','100','300','13','80','FIX','60','2019-10-28','2019-11-28','0' ,1,50,'desc',0)
-- €-40.11580000<br>Colt BE - PRS - FF<br>21/11/2019  -€-4.95860000<br>Proximus - PRS<br>19/11/2019
	-40.11580000										-4.95860000

sheet 6
call prc_GetDIDLCR(1, '334', 'Premium Rate Number', '','0.06 per minute' ,'1992061' ,'9' , 1, '5' ,'2019-11-28','100','300','13','80','FIX','60','2019-10-28','2019-11-28','0' ,1,50,'desc',0);
-- €-13.23000000<br>Teslatel - PRS<br>22/11/2019
    -13.23000000

sheet 7 
call prc_GetDIDLCR(1, '334', 'Premium Rate Number', '','1.22 per minute' ,'8998408' ,'9' , 1, '5' ,'2019-11-28','100','300','13','80','FIX','60','2019-10-28','2019-11-28','0' ,1,50,'desc',0);
-- €-529.56000000<br>Teslatel - PRS<br>22/11/2019 - * was Not matching ( Expected Result was -189.520000)
-- €-189.36000000<br>Teslatel - PRS<br>22/11/2019	( Correct result as per Onno and its matching )	
	-189.36000000

sheet 8
call prc_GetDIDLCR(1, '475', 'Universal Number', '','' ,'0800' ,'9' , 1, '5' ,'2019-11-28','100','300','13','80','FIX','60','2019-10-28','2019-11-28','0' ,1,50,'desc',0)
-- €21.00000000<br>BICS - UIFN<br>13/11/2019
--  21.00000000

call prc_GetDIDLCR(1, '256', 'Universal Number', '','' ,'0800' ,'9' , 1, '5' ,'2019-11-28','100','300','13','80','FIX','60','2019-10-28','2019-11-28','0' ,1,50,'desc',0)
-- €37.14000000<br>BICS - UIFN<br>13/11/2019
	37.14000000

C:\tmp\Comparison_calculation_2019-11-06_v8.xlsx
call prc_GetDIDLCR(1, '475', 'Freephone Number', '','' ,'' ,'9' , 1, '5' ,'2019-12-03','100','300','13','80','MOB','40','2019-11-03','2019-12-03','0' ,1,50,'desc',0);
-- 49.75662627 <br>DIDWW - Freephone<br>06/11/2019      - €18.86000000<br>Ziggo - Freephone Number<br>08/11/2019
   49.75662627											  €18.86000000									

-- FIX 60 ZIGGO
call prc_GetDIDLCR(1, '475', 'Freephone Number', '','' ,'' ,'9' , 1, '5' ,'2019-12-03','100','300','13','80','FIX','60','2019-11-03','2019-12-03','0' ,1,50,'desc',0)
-- 49.75662627 <br>DIDWW - Freephone<br>06/11/2019      - €18.86000000<br>Ziggo - Freephone Number<br>08/11/2019
   49.75662627											  €18.86000000									

-- New C:\tmp\Ziggo_Freephone_-_M4_purchase_downl_-_compare.xlsx
call prc_GetDIDLCR_new(1, '475', 'Freephone Number', '','' ,'0800' ,'9' , 1, '10' ,'2019-12-13','100','300','13','80','FIX','60','2019-11-13','2019-12-13','0' ,1,50,'desc',0)
-- €18.39680000<br>Ziggo - Freephone Number<br>12/12/2019 -- (EXPECTED € 18.30968)


call prc_GetDIDLCR_new(1, '67', 'Premium Rate Number', '','2 per call' ,'0905' ,'9' , 1, '10' ,'2019-12-19','100','300','13','80','FIX','60','2019-11-19','2019-12-19','0' ,1,50,'desc',0);


+-------------+--------------------+---------------------+-----------+------+-----------------+------+-----------------+---------------+---------------------+--------------------+-------------------+------------+------------------+----------------------+-------------+----------------------+----------------------------+---------------------------+-------------------------+------------------+------------------------+----------------------------+-------------------+
| TimezonesID | VendorConnectionID | AccessType          | CountryID | City | Tariff          | Code | OriginationCode | CostPerMinute | OutpaymentPerMinute | SurchargePerMinute | OutpaymentPerCall | Surcharges | SurchargePerCall | CollectionCostAmount | CostPerCall | minute_CostPerMinute | minute_OutpaymentPerMinute | minute_SurchargePerMinute | calls_OutpaymentPerCall | calls_Surcharges | calls_SurchargePerCall | calls_CollectionCostAmount | calls_CostPerCall |
+-------------+--------------------+---------------------+-----------+------+-----------------+------+-----------------+---------------+---------------------+--------------------+-------------------+------------+------------------+----------------------+-------------+----------------------+----------------------------+---------------------------+-------------------------+------------------+------------------------+----------------------------+-------------------+
| 1           | 43                 | Premium Rate Number | 67        |      | 0.15 per minute | 3270 | FIX             |               | 0.12396700          |                    |                   |            |                  |                      | 0.03150000  |                      | 180.00                     |                           |                         |                  |                        |                            | 60.00             |
+-------------+--------------------+---------------------+-----------+------+-----------------+------+-----------------+---------------+---------------------+--------------------+-------------------+------------+------------------+----------------------+-------------+----------------------+----------------------------+---------------------------+-------------------------+------------------+------------------------+----------------------------+-------------------+
| 10          | 43                 | Premium Rate Number | 67        |      | 0.15 per minute | 3270 | FIX             | 0.04550000    |                     |                    |                   |            |                  |                      |             | 36.00                |                            |                           |                         |                  |                        |                            |                   |
+-------------+--------------------+---------------------+-----------+------+-----------------+------+-----------------+---------------+---------------------+--------------------+-------------------+------------+------------------+----------------------+-------------+----------------------+----------------------------+---------------------------+-------------------------+------------------+------------------------+----------------------------+-------------------+
| 13          | 43                 | Premium Rate Number | 67        |      | 0.15 per minute | 3270 | FIX             | 0.05900000    |                     |                    |                   |            |                  |                      |             | 144.00               |                            |                           |                         |                  |                        |                            |                   |
+-------------+--------------------+---------------------+-----------+------+-----------------+------+-----------------+---------------+---------------------+--------------------+-------------------+------------+------------------+----------------------+-------------+----------------------+----------------------------+---------------------------+-------------------------+------------------+------------------------+----------------------------+-------------------+
| 1           | 43                 | Premium Rate Number | 67        |      | 0.15 per minute | 3270 | MOB             |               | 0.12396700          |                    |                   |            |                  |                      | 0.02600000  |                      | 300.00                     |                           |                         |                  |                        |                            | 300.00            |
+-------------+--------------------+---------------------+-----------+------+-----------------+------+-----------------+---------------+---------------------+--------------------+-------------------+------------+------------------+----------------------+-------------+----------------------+----------------------------+---------------------------+-------------------------+------------------+------------------------+----------------------------+-------------------+
| 10          | 43                 | Premium Rate Number | 67        |      | 0.15 per minute | 3270 | MOB             | 0.14500000    |                     |                    |                   |            |                  |                      |             | 60.00                |                            |                           |                         |                  |                        |                            |                   |
+-------------+--------------------+---------------------+-----------+------+-----------------+------+-----------------+---------------+---------------------+--------------------+-------------------+------------+------------------+----------------------+-------------+----------------------+----------------------------+---------------------------+-------------------------+------------------+------------------------+----------------------------+-------------------+
| 13          | 43                 | Premium Rate Number | 67        |      | 0.15 per minute | 3270 | MOB             | 0.15450000    |                     |                    |                   |            |                  |                      |             | 240.00               |                            |                           |                         |                  |                        |                            |                   |
+-------------+--------------------+---------------------+-----------+------+-----------------+------+-----------------+---------------+---------------------+--------------------+-------------------+------------+------------------+----------------------+-------------+----------------------+----------------------------+---------------------------+-------------------------+------------------+------------------------+----------------------------+-------------------+

select * from tmp_origination_minutes;
select @p_months; -- = 1 
*/
/*
orig  minutes
FIX    60
*/

/*
VendorConnectionID  Name
	6						Ziggo - Freephone Number
	14						DIDWW - Freephone
*/
-- select * from tblVendorConnection where VendorConnectionID in (6,14);


/*
Default = 1
Off Peak = 10
Peak		= 13
Weekend	= 16
*/
select * from tblTimezones;
select * from tmp_timezone_minutes where Code = '3270'
order by Tariff,OriginationCode,TimezonesID;

/*

+-------------+--------------------+------------------+-----------+------+--------+-------+---------------+---------------------+--------------------+----------------------+----------------------------+---------------------------+
| TimezonesID | VendorConnectionID | AccessType       | CountryID | City | Tariff | Code  | CostPerMinute | OutpaymentPerMinute | SurchargePerMinute | minute_CostPerMinute | minute_OutpaymentPerMinute | minute_SurchargePerMinute |
+-------------+--------------------+------------------+-----------+------+--------+-------+---------------+---------------------+--------------------+----------------------+----------------------------+---------------------------+
| 1           | 6                  | Freephone Number | 475       |      |        | 31800 |               |                     | 0.01250000         |                      |                            | 100.00                    |
+-------------+--------------------+------------------+-----------+------+--------+-------+---------------+---------------------+--------------------+----------------------+----------------------------+---------------------------+
| 10          | 6                  | Freephone Number | 475       |      |        | 31800 | 0.00800000    |                     |                    | 20.00                |                            |                           |
+-------------+--------------------+------------------+-----------+------+--------+-------+---------------+---------------------+--------------------+----------------------+----------------------------+---------------------------+
| 13          | 6                  | Freephone Number | 475       |      |        | 31800 | 0.01075000    |                     |                    | 80.00                |                            |                           |
+-------------+--------------------+------------------+-----------+------+--------+-------+---------------+---------------------+--------------------+----------------------+----------------------------+---------------------------+
| 1           | 14                 | Freephone Number | 475       |      |        | 31800 | 0.57000000    |                     |                    | 100.00               |                            |                           |
+-------------+--------------------+------------------+-----------+------+--------+-------+---------------+---------------------+--------------------+----------------------+----------------------------+---------------------------+

*/

-- after corrency conversion
select * from tmp_tblRateTableDIDRate_step1;

/*
+-------------+---------------+------------------+---------------+-----------+------+--------+---------------+-------+-----------------+--------------------+--------------------------+-------------+---------------------+-------------+---------------+------------------+--------------------+-------------------+---------------------+------------+------------+----------------------+--------------------------+---------------------------+
| TimezonesID | TimezoneTitle | AccessType       | CountryPrefix | CountryID | City | Tariff | EffectiveDate | Code  | OriginationCode | VendorConnectionID | VendorConnectionName     | MonthlyCost | TrunkCostPerService | CostPerCall | CostPerMinute | SurchargePerCall | SurchargePerMinute | OutpaymentPerCall | OutpaymentPerMinute | Surcharges | Chargeback | CollectionCostAmount | CollectionCostPercentage | RegistrationCostPerNumber |
+-------------+---------------+------------------+---------------+-----------+------+--------+---------------+-------+-----------------+--------------------+--------------------------+-------------+---------------------+-------------+---------------+------------------+--------------------+-------------------+---------------------+------------+------------+----------------------+--------------------------+---------------------------+
| 1           | Default       | Freephone Number | 31            | 475       |      |        | 2019-11-02    | 31800 |                 | 6                  | Ziggo - Freephone Number | 0.00000000  | 0.00000000          | 0.00800000  |               |                  | 0.01250000         |                   |                     |            |            |                      |                          |                           |
+-------------+---------------+------------------+---------------+-----------+------+--------+---------------+-------+-----------------+--------------------+--------------------------+-------------+---------------------+-------------+---------------+------------------+--------------------+-------------------+---------------------+------------+------------+----------------------+--------------------------+---------------------------+
| 10          | Off Peak      | Freephone Number | 31            | 475       |      |        | 2019-11-02    | 31800 |                 | 6                  | Ziggo - Freephone Number |             | 0.00000000          |             | 0.00800000    |                  |                    |                   |                     |            |            |                      |                          |                           |
+-------------+---------------+------------------+---------------+-----------+------+--------+---------------+-------+-----------------+--------------------+--------------------------+-------------+---------------------+-------------+---------------+------------------+--------------------+-------------------+---------------------+------------+------------+----------------------+--------------------------+---------------------------+
| 13          | Peak          | Freephone Number | 31            | 475       |      |        | 2019-11-02    | 31800 |                 | 6                  | Ziggo - Freephone Number |             | 0.00000000          |             | 0.01075000    |                  |                    |                   |                     |            |            |                      |                          |                           |
+-------------+---------------+------------------+---------------+-----------+------+--------+---------------+-------+-----------------+--------------------+--------------------------+-------------+---------------------+-------------+---------------+------------------+--------------------+-------------------+---------------------+------------+------------+----------------------+--------------------------+---------------------------+
| 1           | Default       | Freephone Number | 31            | 475       |      |        | 2019-11-06    | 31800 | FIX             | 14                 | DIDWW - Freephone        | 13.54157263 | 0.00000000          |             | 0.04513858    |                  |                    |                   |                     |            |            |                      |                          |                           |
+-------------+---------------+------------------+---------------+-----------+------+--------+---------------+-------+-----------------+--------------------+--------------------------+-------------+---------------------+-------------+---------------+------------------+--------------------+-------------------+---------------------+------------+------------+----------------------+--------------------------+---------------------------+
| 1           | Default       | Freephone Number | 31            | 475       |      |        | 2019-11-06    | 31800 | MOB             | 14                 | DIDWW - Freephone        | 13.54157263 | 0.00000000          |             | 0.23472059    |                  |                    |                   |                     |            |            |                      |                          |                           |
+-------------+---------------+------------------+---------------+-----------+------+--------+---------------+-------+-----------------+--------------------+--------------------------+-------------+---------------------+-------------+---------------+------------------+--------------------+-------------------+---------------------+------------+------------+----------------------+--------------------------+---------------------------+
| 1           | Default       | Freephone Number | 31            | 475       |      |        | 2019-11-06    | 31800 | PAY             | 14                 | DIDWW - Freephone        | 13.54157263 | 0.00000000          |             | 0.23472059    |                  |                    |                   |                     |            |            |                      |                          |                           |
+-------------+---------------+------------------+---------------+-----------+------+--------+---------------+-------+-----------------+--------------------+--------------------------+-------------+---------------------+-------------+---------------+------------------+--------------------+-------------------+---------------------+------------+------------+----------------------+--------------------------+---------------------------+

*/


select * from tmp_table_without_origination;
/*
+-------------+---------------+------------------+-----------+------+--------+---------------+-------+-----------------+--------------------+--------------------------+-------------+-------------+---------------+------------------+--------------------+-------------------+---------------------+------------+------------+----------------------+--------------------------+---------------------------+------------+------------+--------+------------+
| TimezonesID | TimezoneTitle | AccessType       | CountryID | City | Tariff | EffectiveDate | Code  | OriginationCode | VendorConnectionID | VendorConnectionName     | MonthlyCost | CostPerCall | CostPerMinute | SurchargePerCall | SurchargePerMinute | OutpaymentPerCall | OutpaymentPerMinute | Surcharges | Chargeback | CollectionCostAmount | CollectionCostPercentage | RegistrationCostPerNumber | OutPayment | Surcharge  | Total1 | Total      |
+-------------+---------------+------------------+-----------+------+--------+---------------+-------+-----------------+--------------------+--------------------------+-------------+-------------+---------------+------------------+--------------------+-------------------+---------------------+------------+------------+----------------------+--------------------------+---------------------------+------------+------------+--------+------------+
| 1           | Default       | Freephone Number | 475       |      |        | 2019-11-02    | 31800 |                 | 6                  | Ziggo - Freephone Number | 0.00000000  | 0.00800000  |               |                  | 0.01250000         |                   |                     |            |            |                      |                          |                           | 0.00000000 | 1.25000000 |        | 3.65000000 |
+-------------+---------------+------------------+-----------+------+--------+---------------+-------+-----------------+--------------------+--------------------------+-------------+-------------+---------------+------------------+--------------------+-------------------+---------------------+------------+------------+----------------------+--------------------------+---------------------------+------------+------------+--------+------------+
| 10          | Off Peak      | Freephone Number | 475       |      |        | 2019-11-02    | 31800 |                 | 6                  | Ziggo - Freephone Number |             |             | 0.00800000    |                  |                    |                   |                     |            |            |                      |                          |                           | 0.00000000 | 0.00000000 |        | 0.16000000 |
+-------------+---------------+------------------+-----------+------+--------+---------------+-------+-----------------+--------------------+--------------------------+-------------+-------------+---------------+------------------+--------------------+-------------------+---------------------+------------+------------+----------------------+--------------------------+---------------------------+------------+------------+--------+------------+
| 13          | Peak          | Freephone Number | 475       |      |        | 2019-11-02    | 31800 |                 | 6                  | Ziggo - Freephone Number |             |             | 0.01075000    |                  |                    |                   |                     |            |            |                      |                          |                           | 0.00000000 | 0.00000000 |        | 0.86000000 |
+-------------+---------------+------------------+-----------+------+--------+---------------+-------+-----------------+--------------------+--------------------------+-------------+-------------+---------------+------------------+--------------------+-------------------+---------------------+------------+------------+----------------------+--------------------------+---------------------------+------------+------------+--------+------------+
*/


select * from tmp_table_with_origination;
/*
+-------------+---------------+------------------+-----------+------+--------+---------------+-------+-----------------+--------------------+----------------------+-------------+-------------+---------------+------------------+--------------------+-------------------+---------------------+------------+------------+----------------------+--------------------------+---------------------------+------------+------------+--------+-------------+
| TimezonesID | TimezoneTitle | AccessType       | CountryID | City | Tariff | EffectiveDate | Code  | OriginationCode | VendorConnectionID | VendorConnectionName | MonthlyCost | CostPerCall | CostPerMinute | SurchargePerCall | SurchargePerMinute | OutpaymentPerCall | OutpaymentPerMinute | Surcharges | Chargeback | CollectionCostAmount | CollectionCostPercentage | RegistrationCostPerNumber | OutPayment | Surcharge  | Total1 | Total       |
+-------------+---------------+------------------+-----------+------+--------+---------------+-------+-----------------+--------------------+----------------------+-------------+-------------+---------------+------------------+--------------------+-------------------+---------------------+------------+------------+----------------------+--------------------------+---------------------------+------------+------------+--------+-------------+
| 1           | Default       | Freephone Number | 475       |      |        | 2019-11-06    | 31800 | FIX             | 14                 | DIDWW - Freephone    | 13.54157263 |             | 0.04513858    |                  |                    |                   |                     |            |            |                      |                          |                           | 0.00000000 | 0.00000000 |        | 16.24988743 |
+-------------+---------------+------------------+-----------+------+--------+---------------+-------+-----------------+--------------------+----------------------+-------------+-------------+---------------+------------------+--------------------+-------------------+---------------------+------------+------------+----------------------+--------------------------+---------------------------+------------+------------+--------+-------------+
*/


-- merge above. 
select * from tmp_table1_;
/*
+-------------+---------------+------------------+-----------+------+--------+---------------+-------+-----------------+--------------------+--------------------------+-------------+-------------+---------------+------------------+--------------------+-------------------+---------------------+------------+------------+----------------------+--------------------------+---------------------------+-------------+
| TimezonesID | TimezoneTitle | AccessType       | CountryID | City | Tariff | EffectiveDate | Code  | OriginationCode | VendorConnectionID | VendorConnectionName     | MonthlyCost | CostPerCall | CostPerMinute | SurchargePerCall | SurchargePerMinute | OutpaymentPerCall | OutpaymentPerMinute | Surcharges | Chargeback | CollectionCostAmount | CollectionCostPercentage | RegistrationCostPerNumber | Total       |
+-------------+---------------+------------------+-----------+------+--------+---------------+-------+-----------------+--------------------+--------------------------+-------------+-------------+---------------+------------------+--------------------+-------------------+---------------------+------------+------------+----------------------+--------------------------+---------------------------+-------------+
| 1           | Default       | Freephone Number | 475       |      |        | 2019-11-02    | 31800 |                 | 6                  | Ziggo - Freephone Number | 0.00000000  | 0.00800000  |               |                  | 0.01250000         |                   |                     |            |            |                      |                          |                           | 3.65000000  |
+-------------+---------------+------------------+-----------+------+--------+---------------+-------+-----------------+--------------------+--------------------------+-------------+-------------+---------------+------------------+--------------------+-------------------+---------------------+------------+------------+----------------------+--------------------------+---------------------------+-------------+
| 10          | Off Peak      | Freephone Number | 475       |      |        | 2019-11-02    | 31800 |                 | 6                  | Ziggo - Freephone Number |             |             | 0.00800000    |                  |                    |                   |                     |            |            |                      |                          |                           | 0.16000000  |
+-------------+---------------+------------------+-----------+------+--------+---------------+-------+-----------------+--------------------+--------------------------+-------------+-------------+---------------+------------------+--------------------+-------------------+---------------------+------------+------------+----------------------+--------------------------+---------------------------+-------------+
| 13          | Peak          | Freephone Number | 475       |      |        | 2019-11-02    | 31800 |                 | 6                  | Ziggo - Freephone Number |             |             | 0.01075000    |                  |                    |                   |                     |            |            |                      |                          |                           | 0.86000000  |
+-------------+---------------+------------------+-----------+------+--------+---------------+-------+-----------------+--------------------+--------------------------+-------------+-------------+---------------+------------------+--------------------+-------------------+---------------------+------------+------------+----------------------+--------------------------+---------------------------+-------------+
| 1           | Default       | Freephone Number | 475       |      |        | 2019-11-06    | 31800 | FIX             | 14                 | DIDWW - Freephone        | 13.54157263 |             | 0.04513858    |                  |                    |                   |                     |            |            |                      |                          |                           | 16.24988743 |
+-------------+---------------+------------------+-----------+------+--------+---------------+-------+-----------------+--------------------+--------------------------+-------------+-------------+---------------+------------------+--------------------+-------------------+---------------------+------------+------------+----------------------+--------------------------+---------------------------+-------------+

*/



select * from tmp_final_table_output;

/*
+------------------+-------------+------+--------+-------+--------------------+--------------------------+---------------+--------------+-----------+
| AccessType       | Country     | City | Tariff | Code  | VendorConnectionID | VendorConnectionName     | EffectiveDate | Total        | vPosition |
+------------------+-------------+------+--------+-------+--------------------+--------------------------+---------------+--------------+-----------+
| Freephone Number | NETHERLANDS |      |        | 31800 | 6                  | Ziggo - Freephone Number | 2019-11-02    | €4.67000000  | 1         |
+------------------+-------------+------+--------+-------+--------------------+--------------------------+---------------+--------------+-----------+
| Freephone Number | NETHERLANDS |      |        | 31800 | 14                 | DIDWW - Freephone        | 2019-11-06    | €16.24988743 | 2         |
+------------------+-------------+------+--------+-------+--------------------+--------------------------+---------------+--------------+-----------+
*/


